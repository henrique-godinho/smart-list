<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Grocery Lists</title>
    <link rel="stylesheet" href="main.css">
</head>
<body>
    <!-- Header -->
    <header class="header">
        <h1 class="app-title">Grocery Lists</h1>
        <button class="burger-menu" id="burgerMenu">
            <span></span>
            <span></span>
            <span></span>
        </button>
    </header>

    <!-- Burger Menu Overlay -->
    <div class="menu-overlay" id="menuOverlay">
        <div class="menu-content">
            <button class="menu-close" id="menuClose">&times;</button>
            <nav class="menu-nav">
                <button class="menu-item" id="catalogBtn">
                    <span class="menu-icon">ğŸ“¦</span>
                    Catalog
                </button>
                <button class="menu-item" id="settingsBtn">
                    <span class="menu-icon">âš™ï¸</span>
                    Settings
                </button>
                <button class="menu-item" id="logoutBtn">
                    <span class="menu-icon">ğŸšª</span>
                    Logout
                </button>
            </nav>
        </div>
    </div>

    <!-- Main Content -->
    <main class="main-content">
        <!-- User Lists -->
        <div class="lists-container">
            {{$currentList := ""}}
            {{range .UserList}}
                {{if ne .ListName $currentList}}
                    {{if ne $currentList ""}}
                        </div>
                        
                        <!-- Add Item Section -->
                        <div class="add-item-section">
                            <div class="add-item-input">
                                <input type="text" placeholder="Add new item..." class="item-input">
                                <button class="add-from-catalog-btn" onclick="openCatalogForList(this)">
                                    ğŸ“¦
                                </button>
                            </div>
                            <button class="add-item-btn" onclick="addItem(this)">
                                Add Item
                            </button>
                            <button class="save-list-btn" onclick="saveListFromButton(this)">
                                ğŸ’¾ Save List
                            </button>
                        </div>
                    </div>
                </div>
                    {{end}}
                    {{$currentList = .ListName}}
            <div class="list-card">
                <div class="list-header" onclick="toggleList(this)">
                    <input type="hidden" class="list-id" value="{{.ListID}}">
                    <h2 class="list-name">{{.ListName}}</h2>
                    <div class="list-meta">
                        {{if .TargetDate}}
                            <span class="target-date">ğŸ“… {{.TargetDate}}</span>
                        {{end}}
                        {{if .ListFreq}}
                            <span class="list-freq">ğŸ”„ {{.ListFreq}}</span>
                        {{end}}
                    </div>
                    <button class="expand-btn">
                        <span class="expand-icon">â–¼</span>
                    </button>
                </div>
                
                <div class="list-items">
                {{end}}
                {{if eq .ListName $currentList}}
                    <div class="list-item" data-item-id="{{.ItemID}}">
                        <div class="item-info">
                            <span class="item-name">{{.Name}}</span>
                            <div class="item-details">
                                <span class="qty">Qty: <input type="number" value="{{if .Qty}}{{.Qty}}{{else}}1{{end}}" min="1" class="qty-input" onchange="updateItemQty(this, '{{.ItemID}}', '{{.Name}}')"></span>
                                {{if .Unit}}<span class="unit">{{.Unit}} units</span>{{end}}
                                {{if .Price}}<span class="price">${{.Price}}</span>{{end}}
                            </div>
                            {{if .UpdatedAt}}<span class="updated-at">Updated: {{.UpdatedAt}}</span>{{end}}
                        </div>
                        <button class="remove-item-btn" onclick="removeItem(this)">
                            <span>ğŸ—‘ï¸</span>
                        </button>
                    </div>
                {{end}}
            {{end}}
            {{if ne $currentList ""}}
                </div>
                    
                    <!-- Add Item Section -->
                    <div class="add-item-section">
                        <div class="add-item-input">
                            <input type="text" placeholder="Add new item..." class="item-input">
                            <button class="add-from-catalog-btn" onclick="openCatalogForList(this)">
                                ğŸ“¦
                            </button>
                        </div>
                        <button class="add-item-btn" onclick="addItem(this)">
                            Add Item
                        </button>
                        <button class="save-list-btn" onclick="saveListFromButton(this)">
                            ğŸ’¾ Save List
                        </button>
                    </div>
                </div>
            </div>
            {{end}}
        </div>

        <!-- Create New List Button -->
        <button class="create-list-btn" onclick="createNewList()">
            <span class="plus-icon">+</span>
            Create New List
        </button>
    </main>

    <!-- Catalog Modal -->
    <div class="modal-overlay" id="catalogModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Catalog</h2>
                <button class="modal-close" onclick="closeCatalog()">&times;</button>
            </div>
            
            <div class="catalog-search">
                <input type="text" placeholder="Search items..." class="search-input" id="catalogSearch">
            </div>
            
            <div class="catalog-content">
                {{range .Catalog}}
                <div class="category-section">
                    <div class="category-header" onclick="toggleCategory(this)">
                        <h3 class="category-name">
                            <span class="category-icon">{{.CategoryIcon}}</span>
                            {{.CategoryName}}
                        </h3>
                        <span class="category-toggle">â–¼</span>
                    </div>
                    <div class="category-items">
                        {{range .Items}}
                        <button class="catalog-item" onclick="selectCatalogItem('{{.Name}}')">
                            {{.Name}}
                        </button>
                        {{end}}
                    </div>
                </div>
                {{end}}
            </div>
        </div>
    </div>

    <script src="main.js"></script>
</body>
</html>