<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Grocery Lists</title>
    <link rel="stylesheet" href="main.css">
</head>
<body>
    <!-- Header -->
    <header class="header">
        <h1 class="app-title">Grocery Lists</h1>
        <button class="burger-menu" id="burgerMenu">
            <span></span>
            <span></span>
            <span></span>
        </button>
    </header>

    <!-- Burger Menu Overlay -->
    <div class="menu-overlay" id="menuOverlay">
        <div class="menu-content">
            <button class="menu-close" id="menuClose">&times;</button>
            <nav class="menu-nav">
                <button class="menu-item" id="catalogBtn">
                    <span class="menu-icon">üì¶</span>
                    Catalog
                </button>
                <button class="menu-item" id="settingsBtn">
                    <span class="menu-icon">‚öôÔ∏è</span>
                    Settings
                </button>
                <button class="menu-item" id="logoutBtn">
                    <span class="menu-icon">üö™</span>
                    Logout
                </button>
            </nav>
        </div>
    </div>

    <!-- Main Content -->
    <main class="main-content">
        <!-- User Lists -->
        <div class="lists-container">
            {{$currentList := ""}}
            {{range .UserList}}
                {{if ne .ListName $currentList}}
                    {{if ne $currentList ""}}
                            </div>
                            
                            <!-- Add Item Section -->
                            <div class="add-item-section">
                                <div class="add-item-input">
                                    <input type="text" placeholder="Add new item..." class="item-input">
                                    <button class="add-from-catalog-btn" onclick="openCatalogForList(this)">
                                        üì¶
                                    </button>
                                </div>
                                <button class="add-item-btn" onclick="addItem(this)">
                                    Add Item
                                </button>
                                <button class="save-list-btn" onclick="saveListFromButton(this)">
                                    üíæ Save List
                                </button>
                            </div>
                        </div>
                    {{end}}
                    {{$currentList = .ListName}}
                    <div class="list-card">
                        <div class="list-header" onclick="toggleList(this)">
                            <input type="hidden" class="list-id" value="{{.ListID}}">
                            <h2 class="list-name">{{.ListName}}</h2>
                            <div class="list-meta">
                                {{if .TargetDate}}
                                    <span class="target-date">üìÖ {{.TargetDate}}</span>
                                {{end}}
                                {{if .ListFreq}}
                                    <span class="list-freq">üîÑ {{.ListFreq}}</span>
                                {{end}}
                            </div>
                            <button class="expand-btn">
                                <span class="expand-icon">‚ñº</span>
                            </button>
                        </div>
                        
                        <div class="list-items">
                {{end}}
                {{if eq .ListName $currentList}}
                    {{if .Name }}
                            <div class="list-item" data-item-id="{{.ItemID}}">
                                <div class="item-info">
                                    <span class="item-name">{{.Name}}</span>
                                    <div class="item-details">
                                        <span class="qty">Qty: <input type="number" value="{{if .Qty}}{{.Qty}}{{else}}1{{end}}" min="1" class="qty-input" onchange="updateItemQty(this, '{{.ItemID}}', '{{.Name}}')"></span>
                                        {{if .Unit}}<span class="unit">{{.Unit}} units</span>{{end}}
                                        {{if .Price}}<span class="price">${{.Price}}</span>{{end}}
                                    </div>
                                    {{if .UpdatedAt}}<span class="updated-at">Updated: {{.UpdatedAt}}</span>{{end}}
                                </div>
                                <button class="remove-item-btn" onclick="removeItem(this)">
                                    <span>üóëÔ∏è</span>
                                </button>
                            </div>
                    {{end}}
                {{end}}
            {{end}}
            {{if ne $currentList ""}}
                        </div>
                        
                        <!-- Add Item Section -->
                        <div class="add-item-section">
                            <div class="add-item-input">
                                <input type="text" placeholder="Add new item..." class="item-input">
                                <button class="add-from-catalog-btn" onclick="openCatalogForList(this)">
                                    üì¶
                                </button>
                            </div>
                            <button class="add-item-btn" onclick="addItem(this)">
                                Add Item
                            </button>
                            <button class="save-list-btn" onclick="saveListFromButton(this)">
                                üíæ Save List
                            </button>
                        </div>
                    </div>
            {{end}}
        </div>

        <!-- Create New List Button -->
        <button class="create-list-btn" onclick="createNewList()">
            <span class="plus-icon">+</span>
            Create New List
        </button>
    </main>

    <!-- Catalog Modal -->
    <div class="modal-overlay" id="catalogModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Catalog</h2>
                <button class="modal-close" onclick="closeCatalog()">&times;</button>
            </div>
            
            <div class="catalog-search">
                <input type="text" placeholder="Search items..." class="search-input" id="catalogSearch">
            </div>
            
            <div class="catalog-content">
                {{range .Catalog}}
                <div class="category-section">
                    <div class="category-header" onclick="toggleCategory(this)">
                        <h3 class="category-name">
                            <span class="category-icon">{{.CategoryIcon}}</span>
                            {{.CategoryName}}
                        </h3>
                        <span class="category-toggle">‚ñº</span>
                    </div>
                    <div class="category-items">
                        {{range .Items}}
                        <button class="catalog-item" onclick="selectCatalogItem('{{.Name}}')">
                            {{.Name}}
                        </button>
                        {{end}}
                    </div>
                </div>
                {{end}}
            </div>
        </div>
    </div>

    <!-- Create New List Modal -->
    <div class="modal-overlay" id="createListModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Create New List</h2>
                <button class="modal-close" onclick="closeCreateListModal()">&times;</button>
            </div>
            
            <div class="modal-body" style="padding: 1.5rem;">
                <form onsubmit="event.preventDefault(); submitNewList();">
                    <div class="form-group" style="margin-bottom: 1rem;">
                        <label for="listNameInput" style="display: block; margin-bottom: 0.5rem; color: #40E0D0; font-weight: 500;">
                            List Name *
                        </label>
                        <input 
                            type="text" 
                            id="listNameInput" 
                            class="form-input" 
                            placeholder="e.g. Weekly Groceries, Christmas Shopping..."
                            required
                            style="width: 100%; padding: 0.75rem; background-color: #333; border: 1px solid #444; border-radius: 8px; color: #40E0D0; font-size: 1rem;"
                        >
                    </div>
                    
                    <div class="form-group" style="margin-bottom: 1rem;">
                        <label for="listFrequencySelect" style="display: block; margin-bottom: 0.5rem; color: #40E0D0; font-weight: 500;">
                            Frequency (Optional)
                        </label>
                        <select 
                            id="listFrequencySelect" 
                            class="form-input"
                            style="width: 100%; padding: 0.75rem; background-color: #333; border: 1px solid #444; border-radius: 8px; color: #40E0D0; font-size: 1rem;"
                        >
                            <option value="">Select frequency...</option>
                            <option value="daily">Daily</option>
                            <option value="weekly">Weekly</option>
                            <option value="bi-weekly">Bi-weekly</option>
                            <option value="monthly">Monthly</option>
                            <option value="quarterly">Quarterly</option>
                            <option value="yearly">Yearly</option>
                        </select>
                    </div>
                    
                    <div class="form-group" style="margin-bottom: 1.5rem;">
                        <label for="listTargetDateInput" style="display: block; margin-bottom: 0.5rem; color: #40E0D0; font-weight: 500;">
                            Target Date (Optional)
                        </label>
                        <input 
                            type="date" 
                            id="listTargetDateInput" 
                            class="form-input"
                            style="width: 100%; padding: 0.75rem; background-color: #333; border: 1px solid #444; border-radius: 8px; color: #40E0D0; font-size: 1rem;"
                        >
                    </div>
                    
                    <div class="form-actions" style="display: flex; gap: 0.75rem;">
                        <button 
                            type="button" 
                            onclick="closeCreateListModal()"
                            style="flex: 1; padding: 0.75rem; background-color: #666; border: none; border-radius: 8px; color: white; font-weight: 600; cursor: pointer; transition: all 0.3s ease;"
                        >
                            Cancel
                        </button>
                        <button 
                            type="submit" 
                            id="submitNewListBtn"
                            style="flex: 2; padding: 0.75rem; background-color: #40E0D0; border: none; border-radius: 8px; color: #121212; font-weight: 600; cursor: pointer; transition: all 0.3s ease;"
                        >
                            Create List
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>


    <script src="main.js"></script>
</body>
</html>